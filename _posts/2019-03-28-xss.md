---
layout: post
title: Stored XSS in Private Message component (BuddyPress)
categories: PoC
tags: [Bugbounty, XSS, Translation]
---
출처 : [hackerone hacktivity, 작성자 : Kieran Munday (klmunday)] https://hackerone.com/reports/487081

_[ 본 이슈는 해결 된 상태이며, 취약점은 2019년 3월 9일 오전 7시 28분에 공개되었습니다. 워드프레스에 리포팅 되었으며, 해당 소스코드는 버디프레스(BuddyPress Core)의 것입니다. 취약점의 종류와 강도는 Stored XSS 이며, 포상금은 $500달러로 한화로 약 57만원 입니다. 해당 취약점은 9~10/10 정도의 심각성을 내포하고 있습니다. ]_
- - -
# –설명
워드프레스 버전: 5.0.3 / 버디프레스 버전: 4.1.0

계정을 가진 버디프레스의 유저는 다른 용도를 위해 렌더링된 HTML 코드가 삽입된 비밀 메시지를 보낼 수 있는데, 이것은 script, iframe 등의 자바스크립트 코드를 실행시킬 수 있는 것들을 포함합니다. 이 XSS 코드는 DB에 저장되며 유저가 이 메시지를 읽는 어느 때라도 실행될 수 있습니다. 이 것은(역자 : 취약점이 발생되는 곳은) 유저가 마지막으로 받거나 보낸 메시지를 보여주는 the message preview window도 포함됩니다.

“희생자”가 권한을 부여한 어떠한 (웹앱의) 동작이라도 실행되고 있는 코드는 악용될 수 있으며, 특히 관리자와 같이 권한을 가진 사용자에게는 더 위험합니다. 왜냐하면 권한은 워드프레스 설정과 사용자 이메일과 같은 개인 정보를 열람할 수 있게하기 때문입니다. 이것은 플러그인 등과 같은 어떠한 동작도 포함됩니다.

이 취약점이 발생이 되는 선행 조건은 (기본 권한을 가진) 공격자의 계정과 비밀 메세지 기능이 설정되어있는 버디프레스 설정 외엔 없습니다.
- - -
# – 공격이 발생되는 과정
## 새로운 메세지를 작성할 때 :
1. 다른 사용자의 프로필 페이지로 이동합니다.
1. 비밀 메시지(Private Message)를 클릭합니다.
1. 아무 주제(subject)나 입력합니다.
1. 다음과 같은 메시지를 입력합니다 : `Test<iframe src=javascript:alert(1) width=0 height=0 style=display:none;></iframe>`
1. 메시지를 보냅니다.
1. 메시지를 열람합니다(XSS를 트리거 시킨다).
1. 희생자가 해당 메시지를 보길 기다립니다.

## 기존 스레드에 답할 때 :
1. 본인 계정의 인박스 페이지로 갑니다.
1. 받은 메시지를 열람합니다.
1. 다음과 같은 코드가 첨부된 채 메시지에 답장을 보냅니다 : `Test<iframe src=javascript:alert(1) width=0 height=0 style=display:none;></iframe>`
1. 메시지를 열람합니다(XSS를 트리거 시킨다).
1. 희생자가 해당 메시지를 보길 기다립니다.

페이로드에는 공백이 들어가도 무방하지만 scr에는 어떠한 공백이나 쌍따옴표라도 포함되선 안됩니다. 그렇기 때문에 문자열과 eval’d(역자 : eval()함수)가 포함 된 char 코드로의 변환이 필요합니다.
- - -
